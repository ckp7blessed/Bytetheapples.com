{% extends 'blog/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load custom_tags %}

<!DOCTYPE html>

<body>
{% block content %}	
 	<h1>{{ user_pro.username }}'s Profile</h1>
	<div class="content-section">
		<div class="media">
		    <img class="rounded-circle account-img" src={{ user_pro.profile.image.url }}>
		    <div class="media-body">
		        <p class="text-secondary">Username: {{ user_pro.username }}</p>
		        <p class="text-secondary">Email: {{ user_pro.email|urlize }}</p>
		        <p class="text-dark">Bio: {{ user_pro.profile.bio|urlizetrunc:26 }}</p>
		        <p class="text-dark">Location: {{ user_pro.profile.location }}</p>
		    </div>
		</div>
	</div>
 	<h3 class="mb-3">Posts by {{ view.kwargs.username }}</h3>
	<h4 class="mb-3">Total of {{ user_pro.post_set.all.count }} Posts</h4>

	{% for post in posts %}
	<article class="media content-section shadow">
		<a class="mr-2" href="{% url 'user-posts' post.author.username %}">
			<img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}"></a>
		<div class="media-body">

		{% include 'blog/posts_main.html' %}

		{% if request.user.is_authenticated %}

		<br>
		<form action="{% url 'comment-post-view' %}" method="POST" class="com-form" id="{{ post.id }}">
			{% csrf_token %}
			<input type="hidden" name="post_id" value="{{ post.id }}">
			{{ c_form|crispy }}
			<button type="submit" class="button btn-sm mt-n2 com-btn" id="{{ post.pk }}" name="submit_c_form" style="float:right;">
				Comment 
			</button>

<!-- button btn-sm py-0 mt-n2 mx-auto d-block btn-block com-btn -->

		</form>
		{% else %}
<!-- 		<a href="{% url 'login' %}" class="btn btn-outline-secondary btn-sm py-0 mx-auto d-block btn-block" style="font-size: 0.8em;">comment</a> -->
		<a href="{% url 'login' %}" class="button btn-sm text-decoration-none mt-n2" style="float:right;">Comment</a>
		{% endif %}

		<!-- <button class="cmt_btn button btn-sm">Show replies</button> -->
		
		{% if post.comment_list %}
		<button class="show-replies-button button-empty btn-sm py-0 mx-auto d-block btn-block">Show replies</button>
    	<div class="comment-box" id="comment-box-{{ post.id }}">

			{% if post.comment_list|length|gtoe:7 %}
			<a href="{% url 'latest-comment-post-detail' post.id %}" class="btn btn-outline-secondary btn-sm py-0" style="font-size: 0.8em;">Sort By Latest Comments</a>
			<h5><small class="font-weight-bold" style="font-size: 0.8em;">showing top 7 comments</small></h5>
			{% endif %}

		<div class="comment-list com-list{{ post.id }}" id="{{ post.pk }}">
			{% include 'blog/comments.html' %}

		</div>
			{% if post.comment_list|length|gtoe:7 %}
			<br>
			<a href="{% url 'post-detail' post.id %}" class="btn btn-outline-secondary btn-sm py-0 mx-auto d-block" style="font-size: 0.8em;">Show more replies</a> 
			{% endif %}
		</div>
		{% else %}
		<br><br>
		<div class="comment-list com-list{{ post.id }}" id="{{ post.pk }}">
			{% include 'blog/comments.html' %}
		</div>
		{% endif %}

		</div>
	</article>

	{% endfor %}

	{% include 'blog/comment_template.html' %}

	{% if is_paginated %}

		{% if page_obj.has_previous %}
		<a class="button-empty btn-sm mb-4" href="?page=1">First</a>
		<a class="button-empty btn-sm mb-4" href="?page={{ page_obj.previous_page_number }}">Previous</a>
		{% endif %}

		{% for num in page_obj.paginator.page_range %}
			{% if page_obj.number == num %}
			<a class="button btn-sm mb-4" href="?page={{ num }}">{{ num }}</a>
			{% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
			<a class="button-empty btn-sm mb-4" href="?page={{ num }}">{{ num }}</a>
			{% endif %}
		{% endfor %}

		{% if page_obj.has_next %}
		<a class="button-empty btn-sm mb-4" href="?page={{ page_obj.next_page_number }}">Next</a>
		<a class="button-empty btn-sm mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
		{% endif %}

	{% endif %}

{% endblock content %}

{% block scripts %} 
<script src="{% static 'blog/base.js' %}"></script>
{% endblock scripts %}