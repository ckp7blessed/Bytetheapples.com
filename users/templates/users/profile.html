{% extends 'blog/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load custom_tags %}


{% block content %}

<!-- <div class="content-section">   width:650px;-->
<article class="content-section shadow">
		{% if user.profile.background_image %}
		<br><img data-enlargeable class="img-fluid" style="height:300px; width:690px;" src="{{ user.profile.background_image.url }}"><br>
		{% endif %}
	    <img data-enlargeable class="rounded-circle account-img" src="{{ user.profile.image.url }}">
	        <h2>@{{ user.username }}</h2>
	        <h5>{{ user.first_name }} {{ user.last_name }}</h5>
				<p class="article-content">
			        <span class="text-secondary">Email: {{ user.email|urlize }}</span><br>
			        <span class="text-dark">Bio: {{ user.profile.bio|urlizetrunc:26 }}</span><br>
			        <span class="text-dark">Lives in {{ user.profile.location }}</span><br>
				</p>
		<hr>
		<div>
			{% if user.profile.website_url %}
			<a href="{{ user.profile.website_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded-circle"src="/media/sm_logos/website-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.linkedin_url %}
			<a href="{{ user.profile.linkedin_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded"src="/media/sm_logos/linkedin-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.github_url %}
			<a href="{{ user.profile.github_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded"src="/media/sm_logos/github-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.stackoverflow_url %}
			<a href="{{ user.profile.stackoverflow_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded" src="/media/sm_logos/stackoverflow-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.facebook_url %}
			<a href="{{ user.profile.facebook_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded" src="/media/sm_logos/facebook-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.instagram_url %}
			<a href="{{ user.profile.instagram_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded" src="/media/sm_logos/instagram-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.twitter_url %}
			<a href="{{ user.profile.twitter_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded" src="/media/sm_logos/twitter-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
			{% if user.profile.youtube_url %}
			<a href="{{ user.profile.youtube_url }}" target="_blank" rel="noopener noreferrer"><img class="rounded" src="/media/sm_logos/youtube-logo.png" style="height:50px; width:50px;"></a>
			{% endif %}
		</div>
		<hr>
	<a href="{% url 'profile_settings' %}" class="button" role="button">Settings <i class="fa fa-solid fa-gear"></i></a>
</article>

<div class="content-section pb-5">
<!-- Posts by {{ view.kwargs.username  -->
<h4 style="float:left">Total of {{ user.post_set.all.count }} posts </h4>
	          {% if users_categories %}
	          	<button class="btn dropdown-toggle mr-auto" id="Dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="float:right"> 
	          		Categories
	          	</button>
	          	<div class="dropdown-menu shadow" aria-labelledby="Dropdown">
	          		{% for category in users_categories %}
	          		<a class="dropdown-item" href="{% url 'user-posts-bycat' user.username category %}">{{ category }}</a>
	          		{% endfor %}
	          	</div>
	          {% endif %}

</div>

{% for post in posts %}
	<article class="media content-section shadow">
		<a class="mr-2" href="{% url 'user-posts' post.author.username %}">
			<img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}"></a>
		<div class="media-body">

		{% include 'blog/posts_main.html' %}
		
		{% if request.user.is_authenticated %}
		<br>
		<form action="{% url 'comment-post-view' %}" method="POST" class="com-form" id="{{ post.id }}">
			{% csrf_token %}
			<input type="hidden" name="post_id" value="{{ post.id }}">
			{{ c_form|crispy }}
			<button type="submit" class="button btn-sm mt-n2 com-btn" id="{{ post.pk }}" name="submit_c_form" style="float:right;">
				Comment 
			</button>
		</form>
		{% else %}
		<a href="{% url 'login' %}" class="button btn-sm text-decoration-none mt-n2" style="float:right;">Comment</a>
		{% endif %}
	
		{% if post.comment_list %}
		<button class="show-replies-button button-empty btn-sm py-0 mx-auto d-block btn-block">Show replies</button>
    	<div class="comment-box" id="comment-box-{{ post.id }}">

			{% if post.comment_list|length|gtoe:7 %}
			<a href="{% url 'latest-comment-post-detail' post.id %}" class="btn btn-outline-secondary btn-sm py-0" style="font-size: 0.8em;">Sort By Latest Comments</a>
			<h5 class="text-center"><small class="font-weight-bold text-center" style="font-size: 0.8em;">--showing top comments--</small></h5>
			{% endif %}

			<div class="comment-list com-list{{ post.id }}" id="{{ post.pk }}">
			{% include 'blog/comments.html' %}

			</div>
				{% if post.comment_list|length|gtoe:7 %}
				<br>
				<a href="{% url 'post-detail' post.id %}" class="btn btn-outline-secondary btn-sm py-0 mx-auto d-block" style="font-size: 0.8em;">Show more replies</a> 
				{% endif %}
		</div>
		{% else %}
		<br><br>
		<div class="comment-list com-list{{ post.id }}" id="{{ post.pk }}">
		{% include 'blog/comments.html' %}
		</div>
		{% endif %}
		</div>
	</article>
{% endfor %}

	{% include 'blog/comment_template.html' %}

	{% include 'blog/pagination.html' %}

{% endblock content %}

{% block scripts %} 
<script src="{% static 'blog/base.js' %}"></script>
{% endblock scripts %}